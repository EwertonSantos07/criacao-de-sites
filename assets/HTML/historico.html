<!-- Estrutura Inicial da Página-->
<!DOCTYPE html>
<html lang="en">
    <head>

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-28WKJ8L6QV"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-28WKJ8L6QV');
        </script>

        <!-- Google Tag Manager -->
        <script>
            (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
            })(window,document,'script','dataLayer','GTM-KDCXQ28J');
        </script>
        <!-- End Google Tag Manager -->

        <meta charset="UTF-8">
        <meta 
            name="viewport" 
            content="width=device-width, 
                initial-scale=1.0">

        <meta
            name="description"
            content="Ewerton Santos é um profissional especializado em criação de sites em Curitiba, PR. Desenvolvemos websites personalizados e responsivos para empresas e indivíduos. Solicite um orçamento!">

        <meta 
            name="keywords" 
            content="criação de sites, desenvolvimento web, web designer Curitiba, sites profissionais, orçamento sites">

        <title>Histórico de Criação de Sites | Ewerton Santos - Web Designer Profissional</title>

        <link 
            rel="stylesheet" 
            href="../CSS/2-historico/0-historico.css">

        <link rel="stylesheet" 
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    </head>

    <body>

        <!-- Google Tag Manager (noscript) -->
        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KDCXQ28J"
                height="0" width="0" style="display:none;visibility:hidden">
            </iframe>
        </noscript>
        <!-- End Google Tag Manager (noscript) -->

        <!-- Section Clientes -->
        <section 
            id="historico-de-trabalhos" 
            data-link="historico-de-trabalhos" 
            class="section-historico">
            
            <h3 class="hi-h3">
                Histórico de Trabalhos
            </h3>

            <div class="hi-div-infos">
                <img 
                    class="hi-img"
                    src= ""
                    alt="">
                
                <p class="hi-p">
                    <span
                        id="content-descricao"></span>
                    <a 
                        id="content-link"
                        href="" 
                        target="_blank" 
                        title="">
                        Clique aqui e saiba mais.
                    </a>
                </p>
            </div>

        </section>

        <script>

            //IP para teste local: 127.0.0.1
            //IP para teste no servidor: 192.168.15.38
            //const ipLocal = '127.0.0.1'; //Localhost
            //const ipLocal = '191.255.186.168'; //IP Público Dinâmico
            const ipLocal = "techinfo.webredirect.org" //Sub-domínio
            const urlConteudo = `https://${ipLocal}:5000/api/conteudo`;

            // Função para buscar e exibir dados de texto
            async function buscarConteudo() {
                return new Promise(async (resolve) => {
                    const response = await fetch(urlConteudo)
                    console.log("Resposta:", response)
                    console.log("Continuando...")

                    if (!response.ok) {
                        throw new Error(`Erro na requisição: ${response.status} - ${response.statusText}`);
                    }

                    const retrive_data = await response.json();
                    console.log("Dados recebidos:", retrive_data); 
                    console.log("ID: ", retrive_data.ID); 

                    document.getElementById('content-descricao').textContent = retrive_data.DESCRICAO;
                    const cliqueAqui = document.getElementById("content-link")
                    cliqueAqui.href = retrive_data.LINK_OFICIAL;
                    resolve(retrive_data.PATH_LOGO)
                })
            }

            // Função para buscar e exibir dados de imagem
            async function buscarImgPath(ip, PathImg) {
                return new Promise(async (resolve) => {
                    const urlLogo = `https://${ipLocal}:5000/logos/${PathImg}`;
                    const response2 = await fetch(urlLogo)
                    console.log(response2)

                    const imgID = document.querySelector(".hi-img")
                    imgID.src = urlLogo
                })
            }
                
            // Chamar as funções quando a página carregar
            window.onload = async function() {
                const pathImagem = await buscarConteudo();
                const indexImg = await buscarImgPath(ipLocal, pathImagem);
            };
        </script>

    </body>
</html>